# 商品服务设计

## 商品

### 拉取商品详细信息

传递

```
商品ID
```

返回

```
商品信息
商品所属分类
```

### 获取店铺内商品

传递

```
分类ID
```

返回

分类下的商品

```
商品图片
商品名称
商品详情
商品价格
商品销量（月销）
好评率
库存
```

列表

### 添加商品

传递

```
token
食品分类ID（必填）
食品名称（必填）
食品详情
食品图片
食品规格列表
    规格名称
    价格
```

### 修改商品

传递

```
token
商品ID
名称
详情
分类ID
图片
规格
库存
```

首先根据token获取校验该商品是否属于当前商家，是则对这些信息更新入库

### 删除商品

传递

```
token
商品ID
```

首先根据token获取校验该商品是否属于当前商家并校验该商品是否存在，然后对该商品进行删除

### 拉取商品列表

传递

```
token
页码
每页显示数
```

返回

```
商品信息
商品评分
月销量
```

商品列表

## 获取商品分类

传递

```
店铺ID
```

返回

```
目录名
```

列表

## 评价

## 获取店铺评分

传递

```
店铺ID
```

计算该间店铺评分，返回

### 拉取店铺评价信息

传递

```
店铺ID
```

返回

```
综合评价分数
评价词云列表
```

这里需要注意的是，评价的计算代价是挺大的，应该将其缓存，然后在某一时段更新

### 拉取店铺评价列表

调用者传递

```
店铺ID
```

返回评价列表，评价项包括

```
评价订餐者昵称
评价时间
评价星级
评价内容
```

### 提交评价

订餐者传递

```
token
订单ID
评分
评价内容
```

三样参数

商品服务首先根据token[调用认证服务拉取用户信息](./../基础设施服务群设计.md#认证)
校验该用户是否是订餐者
然后[向订单服务拉取该订单ID的信息](./订单服务设计.md#拉取订单信息)，校验该订单是否属于该订餐者
校验通过，则继续校验订单状态是否为已完结
到这一步，将评价信息写入库

## 目录

### 拉取目录

传递

```
token
```

商家服务[调用认证服务完成这个过程](./../基础设施服务群设计.md#鉴权)获得商家ID

根据商家ID查询目录

```
目录名称
目录描述
```

列表

并返回

### 添加目录

传递

```
token
目录名称
目录描述
```

生成唯一ID，校验参数，入库

### 修改目录

传递

```
token
目录ID
目录名称
目录描述
```

根据目录ID查询店铺ID，调用[店铺服务拉取店铺信息](./店铺服务设计.md#获取店铺信息)
调用[认证服务获取商家信息](./../基础设施服务群设计.md#鉴权)

校验登录商家是否可以管理该店铺，成功则校验参数修改，否则拒绝

### 删除目录

传递

```
token
目录ID
```

根据目录ID查询店铺ID，调用[店铺服务拉取店铺信息](./店铺服务设计.md#获取店铺信息)
调用[认证服务获取商家信息](./../基础设施服务群设计.md#鉴权)

校验登录商家是否可以管理该店铺，成功则继续判断该目录下是否有商品，如果有，拒绝删除