# 骑手服务

## 注册

骑手输入

```
用户名
手机号码
邮箱
登录密码
头像（可为空）
真实姓名
身份证号
性别
```

骑手服务首先对参数进行校验

并确定系统中没有相同用户名、手机号、邮箱的骑手用户
后方可生成一个骑手ID，将这些信息写入数据库，默认将骑手的账户状态设置为不可用
交由后台管理员审核，待后台审核通过，往骑手的邮箱发送一封申请通过通知

## 登录

骑手可以使用

```
用户名
邮箱
手机号
```

中的任一一种以及

```
登录密码
```

来登录，骑手服务将**调用认证服务完成这个过程**，登录成功后骑手服务返回其一个token，后面骑手的所有请求，都必须携带这个token

## 评价

### 提交评价

订餐者传递

```
token
订单ID
评分
评价内容
```

三样参数。

骑手服务首先根据token向认证服务拉取用户信息
校验该用户是否是订餐者
然后**向订单服务拉取该订单ID的信息**，校验该订单是否属于该订餐者
校验通过，则继续校验订单状态是否为已完结
到这一步，将评价信息写入库

### 拉取骑手评价信息

调用者传递

```
骑手ID
```

骑手服务返回

```
骑手综合评价分数
骑手评价词云列表
```

这里需要注意的是，骑手评价的计算代价是挺大的，应该将其缓存，然后在某一时段更新

### 拉取骑手评价列表

调用者传递

```
骑手ID
```

骑手服务返回对骑手的评价列表，评价项包括

```
评价订餐者昵称
评价时间
评价星级
评价内容
```

## 订单

### 接单

传入一个订单号，骑手服务判断该订单状态是否为已完成，是则继续，否则应该拒绝接单
接下来骑手服务调用**订单服务将订单状态置为配送中**，同时将骑手与该订单信息入库

整个过程都应该在分布式事务的控制下进行